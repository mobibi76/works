<!doctype html>
<html lang="ko">
    <head>
        <title>프로세스 디자인 기반 운영 | 리스크 애자일 프로세스와 팀 네트워크 디자인</title>

        <!--meta: SEO, mobile ops. and encoding-->
        <meta name="description"
            content="고객의 목표와 도메인에 대한 체계역학 구조 기반 리스크 애자일 프로세스와 팀 네트워크 디자인">
        <meta name="viewport" content="width=device-width" initial-scale="1.0">
        <meta charset="utf-8">

        <link rel="stylesheet" href="./style/style.css">

        <!--use: jQuery Google CDN-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js" async></script>
        <!--use: fetch.js-->
        <script src="./source/fetch.js"></script>
    </head>

    <body>
        <header>
            <h1><a href="./index.html">process design-based ops.</a></h1>
            <h2>PDB-Ops 서비스(Services)</h2>
        </header>

        <article id="flex">
            <nav id="nav"></nav>
            <main id="container"></main>
            <canvas id="aniCanvas"></canvas>
        </article>

        <script>
            /*--fetch.js control--*/
            // function: define introFetch function
            function introFetch(pageTitle) {
                fetch(pageTitle).then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not OK.');
                    }
                    return response.text();
                }).then(text => {
                    const containerElement = document.querySelector('#container');
                    if (containerElement) {
                        containerElement.innerHTML = text;
                        containerElement.scrollTop = 0;
                    }
                }).catch(error => {
                    console.error('There has been a problem with the fetch operation:', error);
                });
            }

            // function: load pages through fetch.js with ERROR handle
            function fetchPageContent(pageTitle, targetElementSelector) {
                return fetch(pageTitle).then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not OK.');
                    }
                    return response.text();
                }).then(text => {
                    const targetElement = document.querySelector(targetElementSelector);
                    if (targetElement) {
                        targetElement.innerHTML = text;
                        targetElement.scrollTop = 0;
                    }
                }).catch(error => {
                    console.error('There has been a problem with the fetch operation:', error);
                });
            }

            /*--load content on page--*/
                    // function: calculate header-flex to fix scroll issue on container
                    function adjustContainerHeight() {
                        const headers = document.querySelectorAll('header h1, header h2');
                        let headerHeight = 0;
                        headers.forEach(header => {
                            headerHeight += header.getBoundingClientRect().height;
                        });

                        const windowHeight = window.innerHeight;
                        const flexHeight = windowHeight - headerHeight;
                        document.querySelector('#flex').style.height = `${flexHeight}px`;

                        const navElement = document.querySelector('#nav');
                        if (navElement) {
                            navElement.style.height = 'auto';
                            const navHeight = navElement.scrollHeight;
                            navElement.style.height = `${navHeight}px`;
                        }

                        const containerHeight = flexHeight - navElement.offsetHeight;
                        document.querySelector('#container').style.height = `${containerHeight}px`;
                    }

            document.addEventListener("DOMContentLoaded", function() {
                // DOMContentLoaded control and adjust Heithts
                Promise.all([
                    fetchPageContent('Menu', '#nav'),
                    fetchPageContent('Cover', '#container')
                ]).then(() => {
                    adjustContainerHeight();
                    window.addEventListener('resize', adjustContainerHeight);

                    /*--tooltip display for table content--*/ //from.here.on.240924
                    // tooltip for table content (tr, td): mouse event for pc
                    const tooltip = document.createElement('div');
                    tooltip.id = 'tooltip';
                    document.body.appendChild(tooltip);

                    document.addEventListener('mouseover', function (e) {
                        const target = e.target.closest('td[data-tooltip], tr[data-tooltip]');
                        if (target) {
                            const text = target.getAttribute('data-tooltip');
                            tooltip.textContent = text;
                            tooltip.style.display = 'block';
                            tooltip.style.left = `${e.pageX + 10}px`;
                            tooltip.style.top = `${e.pageY + 10}px`;
                        }
                    });

                    document.addEventListener('mousemove', function (e) {
                        if (tooltip.style.display === 'block') {
                            tooltip.style.left = `${e.pageX + 10}px`;
                            tooltip.style.top = `${e.pageY + 10}px`;
                        }
                    });

                    document.addEventListener('mouseout', function (e) {
                        const target = e.target.closest('td[data-tooltip], tr[data-tooltip]');
                        if (!target) {
                            tooltip.style.display = 'none';
                        }
                    });

                    // tooltip for table content (tr, td): touch event for mobile
                    document.addEventListener('touchstart', function (e) {
                        const touch = e.touches[0];
                        const target = document.elementFromPoint(touch.clientX, touch.clientY).closest('td[data-tooltip], tr[data-tooltip]');
                        if (target) {
                            const text = target.getAttribute('data-tooltip');
                            tooltip.textContent = text;
                            tooltip.style.display = 'block';
                            tooltip.style.left = `${touch.pageX + 10}px`;
                            tooltip.style.top = `${touch.pageY + 10}px`;
                        }
                    });

                    document.addEventListener('touchmove', function (e) {
                        const touch = e.touches[0];
                        tooltip.style.left = `${touch.pageX + 10}px`;
                        tooltip.style.top = `${touch.pageY + 10}px`;
                    });

                    document.addEventListener('touchend', function () {
                        tooltip.style.display = 'none';
                    }); //till.here.on.240924


                    /*--tooltip display for images--*/ //from.here.on.240927
                    // tooltip for images: mouse event for pc
                    const imageTooltip = document.createElement('div');
                    imageTooltip.id = 'imageTooltip';
                    document.body.appendChild(imageTooltip);

                    document.addEventListener('mouseover', function(e) {
                        const imgTarget = e.target.closest('img[data-tooltip-image]');
                        if (imgTarget) {
                            const imageUrl = imgTarget.getAttribute('data-tooltip-image');
                            imageTooltip.style.backgroundImage = `url(${imageUrl})`;
                            imageTooltip.style.display = 'block';
                            imageTooltip.style.left = `${e.pageX + 10}px`;
                            imageTooltip.style.top = `${e.pageY + 10}px`;
                        }
                    });

                    document.addEventListener('mousemove', function(e) {
                        if (imageTooltip.style.display === 'block') {
                            imageTooltip.style.left = `${e.pageX + 10}px`;
                            imageTooltip.style.top = `${e.pageY + 10}px`;
                        }
                    });

                    document.addEventListener('mouseout', function(e) {
                        const imgTarget = e.target.closest('img[data-tooltip-image]');
                        if (!imgTarget) {
                            imageTooltip.style.display = 'none';
                        }
                    });

                    // tooltip for images: touch event for mobile
                    document.addEventListener('touchstart', function (e) {
                        const touch = e.touches[0];
                        const imgTarget = document.elementFromPoint(touch.clientX, touch.clientY).closest('img[data-tooltip-image]');
                        if (imgTarget) {
                            const imageUrl = imgTarget.getAttribute('data-tooltip-image');
                            imageTooltip.style.backgroundImage = `url(${imageUrl})`;
                            imageTooltip.style.display = 'block';
                            imageTooltip.style.left = `${touch.pageX + 10}px`;
                            imageTooltip.style.top = `${touch.pageY + 10}px`;
                        }
                    });

                    document.addEventListener('touchmove', function (e) {
                        const touch = e.touches[0];
                        if (imageTooltip.style.display === 'block') {
                            imageTooltip.style.left = `${touch.pageX + 10}px`;
                            imageTooltip.style.top = `${touch.pageY + 10}px`;
                        }
                    });

                    document.addEventListener('touchend', function () {
                        imageTooltip.style.display = 'none';
                    }); //from.here.on.240927
                });
            });

            /*--prevent contents from the mouse right click event--*/
            document.addEventListener('contextmenu', function(event) {
                event.preventDefault();
            });

            /*--push forward to autoplay the video identified--*/
            window.onload = function() {
                var video = document.getElementById("pdbopsVideo");
                
                // fix.canvas.animation from the conflict video.play
                if (video) {
                    video.play().then(function() {
                        console.log("video is playing");
                        startCanvasAnimation();
                    }).catch(function(error) {
                        console.log("video is not playing:", error);
                    }).finally(function() {
                        startCanvasAnimation();
                    });
                } else {
                    console.warn("video is not loading");
                    startCanvasAnimation();
                }
            };

            /*--Canvas Animation--*/
            // start animation
            function startCanvasAnimation() {
                var canvas = document.getElementById("aniCanvas");
                if (canvas) {
                    var obj = canvas.getContext('2d');

                    // resize canvas
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;

                    // set-up object
                    var objAction = [];
                    for (var i = 0; i <100; i++) {
                        objAction.push ({
                            x: Math.random() * canvas.width,
                            y: Math.random() * canvas.height,
                            length: Math.random() * 20 + 10,
                            velocity: Math.random() * 5 + 2
                        });
                    }

                    // draw object
                    function drawObject() {
                        obj.clearRect(0, 0, canvas.width, canvas.height);
                        obj.strokeStyle = 'rgba(175, 195, 225, 0.5)';
                        obj.lineWidth = 1;

                        for (var i = 0; i < objAction.length; i++) {
                            var action = objAction[i];
                            obj.beginPath();
                            obj.moveTo(action.x, action.y);
                            obj.lineTo(action.x, action.y + action.length);
                            obj.stroke();

                            // object movement
                            action.y += action.velocity;
                            if (action.y > canvas.height) {
                                action.y = -action.length;
                            }
                        }
                        requestAnimationFrame(drawObject);
                    }
                    drawObject();

                    // resize canvas again
                    window.addEventListener('resize', function() {
                        canvas.width = window.innerWidth;
                        canvas.height = window.innerHeight;
                    });
                } else {
                    console.error("canvas is not loading");
                }
            }
        </script>
    </body>
</html>